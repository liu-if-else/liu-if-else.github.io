<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <title>Unity3D Audio Visualizer | liu_if_else's blog</title>
    <meta name="description" content="Understand the Unity GetSpectrumData function, the spectrum datas, the Fourier transform and related theorems and ultilize them to make a audio visualizer in...">
    
        <meta name="keywords" content="Unity3D, AudioVisualizer">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Unity3D Audio Visualizer | liu_if_else's blog">
    <meta name="twitter:description" content="Understand the Unity GetSpectrumData function, the spectrum datas, the Fourier transform and related theorems and ultilize them to make a audio visualizer in...">
    <meta property="twitter:image:src" content="https://res.cloudinary.com/dokdkay80/image/upload/c_scale,w_760/v1604498366/AudioVisualizer/av1_itqijr.png">
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="http://localhost:4000/unity3d-audio-visualizer/">
    <meta property="og:title" content="Unity3D Audio Visualizer | liu_if_else's blog">
    <meta property="og:image" content="https://res.cloudinary.com/dokdkay80/image/upload/c_scale,w_760/v1604498366/AudioVisualizer/av1_itqijr.png">
    <meta property="og:description" content="Understand the Unity GetSpectrumData function, the spectrum datas, the Fourier transform and related theorems and ultilize them to make a audio visualizer in...">
    <meta property="og:site_name" content="liu_if_else's blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="liu_if_else's blog">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="http://localhost:4000/unity3d-audio-visualizer/">
    <link rel="alternate" type="application/rss+xml" title="liu_if_else's blog" href="http://localhost:4000/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>
</head>

    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                liu_if_else's blog <span class="version">v1.0.0</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="http://localhost:4000/">Home</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/about">About</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post one-column">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2020-11-04T21:37:54+08:00">
                            


November 4, 2020

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>16 min to read</span>
                </p>
                <h1 class="post-title">Unity3D Audio Visualizer</h1>
                <p class="post-subtitle">Understand Unity3D's GetSpectrumData function and use it make a audio visulizer.</p>

                
                    <img src="https://res.cloudinary.com/dokdkay80/image/upload/c_scale,w_760/v1604498366/AudioVisualizer/av1_itqijr.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <h1 id="menu">Menu</h1>
<ul>
  <li><a href="#take-a-gander-at-some-terminologies-and-concepts">Take a gander at some terminologies and concepts</a></li>
  <li><a href="#understand-the-unity-getspectrumdata-function">Understand the Unity GetSpectrumData function</a></li>
  <li><a href="#the-spectrum-datas-and-the-Fourier-transform">The spectrum datas and the Fourier transform</a></li>
  <li><a href="#provide-the-spectrum-datas-to-the-audio-visulizer">Provide the spectrum datas to the audio visulizer</a></li>
</ul>

<h1 id="take-a-gander-at-some-terminologies-and-concepts">Take a gander at some terminologies and concepts</h1>

<p><strong>Sound</strong>: A sort of wave, viberated in the air with a frequency between 20Hz and 20000Hz.<br />
<strong>Sound Frequency</strong>: The times that sound viberated per second. It’s unit is herz. <br />
<strong>Sampling</strong>: Get a sample, a value, from a sound wave.   <br />
<strong>Sampling Rate</strong>: The times of the Sampling per second.  <br />
<strong>Fast Fourier Transform</strong>: the FFT can used to transform signals.<br />
<strong>Window Function</strong>: To reduce the “signal to noise ratio”.<br />
<strong>Decibel</strong>: A well-known value used to measure sound’s volume. In this artikel, the strength of the sound wave is a relative value and has nothing to do with the decibel.</p>

<h1 id="understand-the-unity-getspectrumdata-function">Understand the Unity GetSpectrumData function</h1>

<p><strong>public void GetSpectrumData(float[] samples, int channel, FFTWindow window);</strong></p>

<p><strong>samples</strong>: The array is the return value of the funciton. Each element’s value is the strength of the audio source at a certain frequency. To be optimized for the Fourier transform algorithm, the length of the array must be the power of two, minimal 64 and maximum 8192.<br />
<strong>channel</strong>: Stereo seperates a audio source into different parts, or say channels, and provided them to distanced audio hardwares to play. In this case, the channel parameter can be used to choose a certain channel to sample by the FFT. Setting to 0 will sample all channels, as same as in case of mono.<br />
<strong>window</strong>: A helper function for the FFT to reduce noises. There is a trade-off of the complexity of the window-function for reducing the noises.<br />
<strong>usage</strong>:</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="kt">float</span><span class="p">[]</span> <span class="n">spectrumData</span><span class="p">=</span><span class="k">new</span> <span class="kt">float</span><span class="p">[</span><span class="m">8192</span><span class="p">];</span>  
<span class="n">thisAudioSource</span><span class="p">.</span><span class="nf">GetSpectrumData</span><span class="p">(</span><span class="n">spectrumData</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="n">FFTWindow</span><span class="p">.</span><span class="n">BlackmanHarris</span><span class="p">);</span>  
</code></pre></div></div>

<h1 id="the-spectrum-datas-and-the-fourier-transform">The spectrum datas and the Fourier transform</h1>

<p>Given the sampling time T, the samples N and the sampling rate $f_s$, we can make a formula: $T=N/f_s$.</p>

<p>The reciprocal of T, $f_s/N$, is called Frequency Resolution. The charts below are the results of the FFT of the demo audio. They show that the higher the Frequency Resolution the denser the datas transformed.</p>

<p><img src="https://res.cloudinary.com/dokdkay80/image/upload/v1604498587/AudioVisualizer/av3_vnggql.png" alt="placeholder" />
<img src="https://res.cloudinary.com/dokdkay80/image/upload/v1604498510/AudioVisualizer/av4_ljqbsw.png" alt="placeholder" /></p>

<p>The length of the spectrumData array is actually the Frequency Resolution and every array’s element has a x/y value in the diagrams above. Unfortunately, we can’t get the frequency, the x, of a element(but well the strength which is y) at runtime and I can’t find any clue in the Unity documentation either. So let’s try to figure it out through some tests.</p>

<p>Using a software to analyze “[MV] FIESTAR(피에스타) _ Mirror.mp3”, we can see that there is a free fall of the strength values at the 16000Hz frequency.</p>

<p><img src="https://res.cloudinary.com/dokdkay80/image/upload/v1604498406/AudioVisualizer/av5_aze0ep.png" alt="placeholder" /></p>

<p>Back to Unity, Debugging the spectrumdata’s values, there is also a significant decrease at spectrumData[5500]. Therefore, it can be deduced that the spectrumData[5500] represences the frequency around 16000Hz. Moreover, 16000Hz/5500*8192=23831Hz, we can also conclude that the highest frequency the function returned is between 22000Hz to 24000Hz.</p>

<p>In addtion to the tests, other clues can be found from the angle of the Fourier Transform. The core algorithm of GetSpectrumData function is the FFT. As mentioned in the beginning, sound is a sort of wave where frequency decided pitch and amplitude determined volume.</p>

<p><img src="https://res.cloudinary.com/dokdkay80/image/upload/v1605801186/AudioVisualizer/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2020-11-19_%E4%B8%8B%E5%8D%8811.21.18_k0pcox.png" alt="placeholder" /></p>

<p>The graph above have shown the two sound waves with stable frequency and gradually amplified amplitude in the x-time/y-amplitude plane. According to the superposition principle, simply adding these waves will generate a new complex wave.</p>

<p><img src="https://res.cloudinary.com/dokdkay80/image/upload/v1605801187/AudioVisualizer/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2020-11-19_%E4%B8%8B%E5%8D%8811.22.20_fdt7q0.png" alt="placeholder" /></p>

<p>This is exactly what happend when the different sound waves met in the air and created a mixed tone. The datas of a audio file are just the discrete samples of a complex sound wave. From this perspective, we can say that making audio/music is adding different sound waves into a complex wave. Just the opposite, the Fourier Transform breaks down complex wave. No matter how complex the wave is, through a series of magical calculations(much more complicated than mixing them), the FT can identify every single-frequency wave within it.</p>

<p>From the viewpoint of two-dimensional space, the Fourier Transform will translate the complex wave from the “x-time/y-amplitude” plane(the last chart above) to the “x-frequency/y-strength”(e.g the third graph) and then to many “x-time/y-strength of a wave with fixed frequency”. The strength of every single wave, the y, on the time axis will become the value of the correspond element of spectrumData array.</p>

<p>In this transfomation process, the FFT firstly needs to sample the original complex wave on the time axis with a fast interval repeatedly. To correctly reconstruct the single-frequency wave, sufficient samples are necessary. Here comes “the Nyquist–Shannon sampling theorem”. To put it simply, the theorem states that the number of the sufficient samples is the frequency multiply by two. For instance, for a 3Hz wave you need 6 samples.</p>

<p>The nowadays music industry adopts the 44100Hz sampling rate standard. So a music audio of one second contains 44100 samples. Because of the restriction of the Nyquist theorem, the highest frequency the FFT can correctly analyze is 22050Hz, which is consistent with the conclusion of the tests above. Given the highest frequency and the length of the spectrumData array, we can further determine the exact frequencies presented by the elements of the array. For example, the demo project has used a 8192 array:</p>

<p>spectrumData[0]		&lt;=&gt;		22050Hz/8192*1    = 2.6916 Hz  &lt;=&gt;  6 times sampling per second<br />
spectrumData[1]		&lt;=&gt;		22050Hz/8192*2    = 5.3833 Hz  &lt;=&gt;  11 times sampling per second<br />
…  <br />
spectrumData[8191]	&lt;=&gt;		22050Hz/8192*8192 = 22050  Hz  &lt;=&gt;  44100 times sampling per second</p>

<p>The dependecies above also tell us that the longer the array the more the sampling and thus the more performance cost of the GetSpectrumData function.</p>

<p>Through adjusting the length of the array, any certain frequency’s strength can be obtained and hence the analyze can be extended to other dimensions, e.g the pitchs.</p>

<p><img src="https://res.cloudinary.com/dokdkay80/image/upload/v1605164286/AudioVisualizer/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2020-11-12_%E4%B8%8B%E5%8D%882.57.30_vdylrr.png" alt="placeholder" /></p>

<p>According to this <a href="https://en.wikipedia.org/wiki/Scientific_pitch_notation">pitch/frequncy table</a>, the highest pitch’s frequncy of octave 9 is 15804Hz, which explained a little about the free fall at 16000Hz of the FFT result’s chart above as well.</p>

<h1 id="provide-the-spectrum-datas-to-the-audio-visulizer">Provide the spectrum datas to the audio visulizer</h1>

<p><a href="https://github.com/liu-if-else/UnitySpectrumData">Github Link of the demo project</a></p>

<p>In the demo project, I obtained the spectrum datas in Update and injected them to the scale of the cubes and the colors of their materials. The workload is distributed to both CPU and GPU. If you want to reduce the burden of CPU, another idea is to translate the whole spectrum datas, the array, to the GPU(since you have to use this bandwidth to set colors anyway) and to hand over all the work to the shaders, like vertex animation, color calculation and etc. Using vertex or fragment shader to calculate the color instead of CPU is also more friendly for batching and will reduce a lot of SetPass calls.</p>

<p>Since the highest frequncy of the song is below 16000Hz, the audio visualizer only uses the 5461 of 8192 cubes to construct itself.</p>

<p>The core logics of the demo are in the Controller script: <br />
<br /></p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">DG.Tweening</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Controller</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
    <span class="c1">//audio related</span>
    <span class="k">public</span> <span class="n">AudioSource</span> <span class="n">thisAudioSource</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">float</span><span class="p">[]</span> <span class="n">spectrumData</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">float</span><span class="p">[</span><span class="m">8192</span><span class="p">];</span>
    <span class="c1">//cube related</span>
	<span class="k">public</span> <span class="n">GameObject</span> <span class="n">cubePrototype</span><span class="p">;</span>
	<span class="k">public</span> <span class="n">Transform</span> <span class="n">startPoint</span><span class="p">;</span>
	<span class="k">private</span> <span class="n">Transform</span><span class="p">[]</span> <span class="n">cube_transforms</span><span class="p">=</span><span class="k">new</span> <span class="n">Transform</span><span class="p">[</span><span class="m">8192</span><span class="p">];</span>
    <span class="k">private</span> <span class="n">Vector3</span><span class="p">[]</span> <span class="n">cubes_position</span><span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">[</span><span class="m">8192</span><span class="p">];</span>
    <span class="c1">//color related</span>
    <span class="k">public</span> <span class="n">GridOverlay</span> <span class="n">gridOverlay</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">MeshRenderer</span><span class="p">[]</span> <span class="n">cube_meshRenderers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MeshRenderer</span><span class="p">[</span><span class="m">8192</span><span class="p">];</span>
    <span class="k">private</span> <span class="kt">bool</span> <span class="n">cubeColorChange</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">bool</span> <span class="n">gridColorChange</span><span class="p">;</span>
    <span class="c1">//camera movement related</span>
    <span class="k">public</span> <span class="n">Vector3</span> <span class="n">cameraStartPoint</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">Transform</span> <span class="n">cameraTransform</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">lookat0_1</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">lookat1_2</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">lookat2_3</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">Vector3</span> <span class="n">lookat0_1_vector</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">Vector3</span> <span class="n">lookat1_2_vector</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">106f</span><span class="p">,</span> <span class="m">12f</span><span class="p">,</span> <span class="m">78f</span><span class="p">);</span>
    <span class="k">public</span> <span class="n">Vector3</span> <span class="n">lookat2_3_vector</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">Vector3</span><span class="p">[]</span> <span class="n">moveTos</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">[</span><span class="m">8192</span><span class="p">];</span>
    <span class="k">public</span> <span class="n">Transform</span> <span class="n">cubes_parent</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">bool</span> <span class="n">cubesRotate</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
	<span class="c1">// Use this for initialization</span>
	<span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">//cube generation</span>
		<span class="n">Vector3</span> <span class="n">p</span><span class="p">=</span><span class="n">startPoint</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>

		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span><span class="n">i</span><span class="p">&lt;</span><span class="m">8192</span><span class="p">;</span><span class="n">i</span><span class="p">++){</span>
			<span class="n">p</span><span class="p">=</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">+</span><span class="m">0.11f</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
            <span class="n">GameObject</span> <span class="n">cube</span><span class="p">=</span><span class="n">Object</span><span class="p">.</span><span class="nf">Instantiate</span><span class="p">(</span><span class="n">cubePrototype</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">cubePrototype</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">)</span><span class="k">as</span> <span class="n">GameObject</span><span class="p">;</span>
			<span class="n">cube_transforms</span><span class="p">[</span><span class="n">i</span><span class="p">]=</span><span class="n">cube</span><span class="p">.</span><span class="n">transform</span><span class="p">;</span>
            <span class="n">cube_meshRenderers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span><span class="n">cube</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">MeshRenderer</span><span class="p">&gt;();</span>
		<span class="p">}</span>

		<span class="n">p</span><span class="p">=</span><span class="n">startPoint</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>

		<span class="kt">float</span> <span class="n">a</span><span class="p">=</span><span class="m">2f</span><span class="p">*</span><span class="n">Mathf</span><span class="p">.</span><span class="n">PI</span><span class="p">/</span><span class="m">5461</span><span class="p">;</span>

		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span><span class="n">i</span><span class="p">&lt;</span><span class="m">5461</span><span class="p">;</span><span class="n">i</span><span class="p">++){</span>
			<span class="n">cube_transforms</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">position</span><span class="p">=</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">+</span><span class="n">Mathf</span><span class="p">.</span><span class="nf">Cos</span><span class="p">(</span><span class="n">a</span><span class="p">)*</span><span class="m">131</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">+</span><span class="m">131</span><span class="p">*</span><span class="n">Mathf</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
			<span class="n">a</span><span class="p">+=</span><span class="m">2f</span><span class="p">*</span><span class="n">Mathf</span><span class="p">.</span><span class="n">PI</span><span class="p">/</span><span class="m">5461</span><span class="p">;</span>
            <span class="n">cubes_position</span><span class="p">[</span><span class="n">i</span><span class="p">]=</span><span class="n">cube_transforms</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">position</span><span class="p">;</span>
			<span class="n">cube_transforms</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">parent</span><span class="p">=</span><span class="n">startPoint</span><span class="p">;</span>
		<span class="p">}</span>
        <span class="c1">//manage color</span>
        <span class="n">gridColorChange</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">cubeColorChange</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="nf">Invoke</span><span class="p">(</span><span class="s">"SwitchCC"</span><span class="p">,</span> <span class="m">3f</span><span class="p">);</span>
        <span class="c1">//manage camera</span>
        <span class="n">cameraStartPoint</span> <span class="p">=</span> <span class="n">cameraTransform</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
        <span class="nf">StartCoroutine</span><span class="p">(</span><span class="nf">CameraMovement</span><span class="p">());</span>
        <span class="c1">//delay the music</span>
        <span class="n">thisAudioSource</span><span class="p">.</span><span class="nf">PlayDelayed</span><span class="p">(</span><span class="m">2f</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="c1">// Update is called once per frame</span>
	<span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nf">Spectrum2Cube</span><span class="p">();</span>
        <span class="nf">DynamicColor</span><span class="p">();</span>
        <span class="nf">CameraLookAt</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="c1">//color related</span>
    <span class="k">void</span> <span class="nf">SwitchCC</span><span class="p">(){</span>
        <span class="n">cubeColorChange</span> <span class="p">=</span> <span class="p">!</span><span class="n">cubeColorChange</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">void</span> <span class="nf">SwitchGC</span><span class="p">(){</span>
        <span class="n">gridColorChange</span> <span class="p">=</span> <span class="p">!</span><span class="n">gridColorChange</span><span class="p">;</span>
    <span class="p">}</span>
	<span class="k">void</span> <span class="nf">DynamicColor</span><span class="p">(){</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cubeColorChange</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">5461</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">cube_meshRenderers</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">material</span><span class="p">.</span><span class="nf">SetColor</span><span class="p">(</span><span class="s">"_Color"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Vector4</span><span class="p">(</span><span class="n">Mathf</span><span class="p">.</span><span class="nf">Lerp</span><span class="p">(</span><span class="n">cube_meshRenderers</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">material</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">r</span><span class="p">,</span> <span class="n">spectrumData</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">*</span> <span class="m">500f</span><span class="p">,</span> <span class="m">0.2f</span><span class="p">),</span> <span class="m">0.5f</span><span class="p">,</span> <span class="m">1f</span><span class="p">,</span> <span class="m">1f</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">gridColorChange</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">float</span> <span class="n">gridColor</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Lerp</span><span class="p">(</span><span class="n">gridOverlay</span><span class="p">.</span><span class="n">mainColor</span><span class="p">.</span><span class="n">r</span><span class="p">,</span> <span class="n">spectrumData</span><span class="p">[</span><span class="m">2000</span><span class="p">]</span> <span class="p">*</span> <span class="m">1000</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">gridColor</span> <span class="p">&gt;</span> <span class="m">1</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">gridColor</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">gridOverlay</span><span class="p">.</span><span class="n">mainColor</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector4</span><span class="p">(</span><span class="n">gridColor</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">,</span> <span class="m">1f</span><span class="p">,</span> <span class="m">1f</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//inject spectrumDatas to the scale of the cubes</span>
    <span class="k">void</span> <span class="nf">Spectrum2Cube</span><span class="p">(){</span>
        <span class="n">thisAudioSource</span><span class="p">.</span><span class="nf">GetSpectrumData</span><span class="p">(</span><span class="n">spectrumData</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">FFTWindow</span><span class="p">.</span><span class="n">BlackmanHarris</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">5461</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">cube_transforms</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">localScale</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0.15f</span><span class="p">,</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Lerp</span><span class="p">(</span><span class="n">cube_transforms</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">localScale</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">spectrumData</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">*</span> <span class="m">10000f</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">),</span> <span class="m">0.15f</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//manage the angles of the camera</span>
    <span class="k">void</span> <span class="nf">CameraLookAt</span><span class="p">(){</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lookat0_1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">LookAt</span><span class="p">(</span><span class="n">lookat0_1_vector</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lookat1_2</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">LookAt</span><span class="p">(</span><span class="n">lookat1_2_vector</span><span class="p">);</span>

        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lookat2_3</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">LookAt</span><span class="p">(</span><span class="n">cubes_position</span><span class="p">[</span><span class="m">5190</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//animate the grid</span>
    <span class="n">IEnumerator</span> <span class="nf">GridOff</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">51</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">gridOverlay</span><span class="p">.</span><span class="n">largeStep</span> <span class="p">+=</span> <span class="m">10</span><span class="p">;</span>
            <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span><span class="p">(</span><span class="m">0.02f</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">gridOverlay</span><span class="p">.</span><span class="n">showMain</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

    <span class="p">}</span>
    <span class="n">IEnumerator</span> <span class="nf">GridOn</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">gridOverlay</span><span class="p">.</span><span class="n">showMain</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="n">gridColorChange</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="n">gridOverlay</span><span class="p">.</span><span class="n">largeStep</span> <span class="p">=</span> <span class="m">500</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">49</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">gridOverlay</span><span class="p">.</span><span class="n">largeStep</span> <span class="p">-=</span> <span class="m">10</span><span class="p">;</span>
            <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span><span class="p">(</span><span class="m">0.02f</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//repeat the camera movement. TODO: exit mechanism</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">CameraRepeatMove</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">StopAllCoroutines</span><span class="p">();</span>
        <span class="nf">StartCoroutine</span><span class="p">(</span><span class="nf">CameraMovement</span><span class="p">());</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cubesRotate</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">cubesRotate</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="n">cubes_parent</span><span class="p">.</span><span class="nf">DORotate</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0f</span><span class="p">,</span> <span class="m">360f</span><span class="p">,</span> <span class="m">0f</span><span class="p">),</span> <span class="m">117f</span><span class="p">,</span> <span class="n">RotateMode</span><span class="p">.</span><span class="n">FastBeyond360</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">gridColorChange</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//move the camera</span>
    <span class="n">IEnumerator</span> <span class="nf">CameraMovement</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span><span class="p">(</span><span class="m">20f</span><span class="p">);</span>
        <span class="n">lookat2_3_vector</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">cubes_position</span><span class="p">[</span><span class="m">5200</span><span class="p">].</span><span class="n">x</span><span class="p">,</span> <span class="m">12f</span><span class="p">,</span> <span class="n">cubes_position</span><span class="p">[</span><span class="m">5200</span><span class="p">].</span><span class="n">z</span><span class="p">);</span>
        <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">DOMove</span><span class="p">(</span><span class="n">startPoint</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="m">20f</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">8192</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">moveTos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">cubes_position</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">,</span> <span class="m">10f</span><span class="p">,</span> <span class="n">cubes_position</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">z</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span><span class="p">(</span><span class="m">20f</span><span class="p">);</span>
        <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">DOMove</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">126f</span><span class="p">,</span> <span class="m">252f</span><span class="p">,</span> <span class="m">1f</span><span class="p">),</span> <span class="m">10f</span><span class="p">);</span>
        <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">DOLookAt</span><span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">10f</span><span class="p">,</span> <span class="n">AxisConstraint</span><span class="p">.</span><span class="n">None</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span><span class="p">);</span>
        <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span><span class="p">(</span><span class="m">10f</span><span class="p">);</span>
        <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">DOMove</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">106f</span><span class="p">,</span> <span class="m">12f</span><span class="p">,</span> <span class="m">78f</span><span class="p">),</span> <span class="m">19f</span><span class="p">);</span>
        <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">DOLookAt</span><span class="p">(</span><span class="n">lookat1_2_vector</span><span class="p">,</span> <span class="m">19f</span><span class="p">,</span> <span class="n">AxisConstraint</span><span class="p">.</span><span class="n">None</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span><span class="p">);</span>
        <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span><span class="p">(</span><span class="m">19f</span><span class="p">);</span>
        <span class="n">lookat1_2</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="nf">StartCoroutine</span><span class="p">(</span><span class="nf">GridOn</span><span class="p">());</span>
        <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">DOLookAt</span><span class="p">(</span><span class="n">lookat2_3_vector</span><span class="p">,</span> <span class="m">8f</span><span class="p">,</span> <span class="n">AxisConstraint</span><span class="p">.</span><span class="n">None</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span><span class="p">);</span>
        <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">DOMove</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">cubes_position</span><span class="p">[</span><span class="m">5460</span><span class="p">].</span><span class="n">x</span><span class="p">,</span> <span class="m">12f</span><span class="p">,</span> <span class="n">cubes_position</span><span class="p">[</span><span class="m">5460</span><span class="p">].</span><span class="n">z</span><span class="p">),</span> <span class="m">8f</span><span class="p">);</span>
        <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span><span class="p">(</span><span class="m">8f</span><span class="p">);</span>
        <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">DOLookAt</span><span class="p">(</span><span class="n">cubes_position</span><span class="p">[</span><span class="m">5200</span><span class="p">],</span> <span class="m">2f</span><span class="p">,</span> <span class="n">AxisConstraint</span><span class="p">.</span><span class="n">None</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span><span class="p">);</span>
        <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span><span class="p">(</span><span class="m">2f</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">counter</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">counter</span> <span class="p">&lt;</span> <span class="m">2700</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">LookAt</span><span class="p">(</span><span class="n">cubes_position</span><span class="p">[</span><span class="m">5200</span> <span class="p">-</span> <span class="n">counter</span><span class="p">]);</span>
            <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">DOMove</span><span class="p">(</span><span class="n">moveTos</span><span class="p">[</span><span class="m">5460</span> <span class="p">-</span> <span class="n">counter</span><span class="p">],</span> <span class="m">0.01f</span><span class="p">);</span>
            <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span><span class="p">(</span><span class="m">0.01f</span><span class="p">);</span>
            <span class="n">counter</span> <span class="p">+=</span> <span class="m">10</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">DOLookAt</span><span class="p">(</span><span class="n">lookat0_1_vector</span><span class="p">,</span> <span class="m">3f</span><span class="p">,</span> <span class="n">AxisConstraint</span><span class="p">.</span><span class="n">None</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span><span class="p">);</span>
        <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span><span class="p">(</span><span class="m">3f</span><span class="p">);</span>
        <span class="nf">StartCoroutine</span><span class="p">(</span><span class="nf">GridOff</span><span class="p">());</span>
        <span class="n">lookat0_1</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="n">cameraTransform</span><span class="p">.</span><span class="nf">DOMove</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">cameraStartPoint</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cameraStartPoint</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="m">300f</span><span class="p">,</span> <span class="n">cameraStartPoint</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="m">6f</span><span class="p">);</span>
        <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span><span class="p">(</span><span class="m">6f</span><span class="p">);</span>
        <span class="n">lookat0_1</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="nf">CameraRepeatMove</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span> 
</code></pre></div></div>

<p>Screenshots from the Editor:</p>

<p><img src="https://res.cloudinary.com/dokdkay80/image/upload/v1604498463/AudioVisualizer/av2_r15mar.png" alt="placeholder" /></p>

<p><img src="https://res.cloudinary.com/dokdkay80/image/upload/v1604498366/AudioVisualizer/av1_itqijr.png" alt="placeholder" /></p>

<hr />
<p><strong>References:</strong><br />
the Nyquist–Shannon sampling theorem — Zero to One<br />
<a href="https://www.cnblogs.com/zoneofmine/p/10853096.html">https://www.cnblogs.com/zoneofmine/p/10853096.html</a></p>

<p>Algorithmic Beat Mapping in Unity: Real-time Audio Analysis Using the Unity API — Jesse<br />
<a href="https://medium.com/giant-scam/algorithmic-beat-mapping-in-unity-real-time-audio-analysis-using-the-unity-api-6e9595823ce4">https://medium.com/giant-scam/algorithmic-beat-mapping-in-unity-real-time-audio-analysis-using-the-unity-api-6e9595823ce4</a></p>

<p>What is the Fourier Transform — 3Blue1Brown<br />
<a href="https://www.youtube.com/watch?v=spUNpyF58BY">https://www.youtube.com/watch?v=spUNpyF58BY</a></p>

<hr />
<p><strong>Chinese Version of this artikel:</strong><br />
<a href="https://blog.csdn.net/liu_if_else/article/details/51233799">https://blog.csdn.net/liu_if_else/article/details/51233799</a></p>


                <!-- Pagination links -->


            </article>

            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="16">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <div class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    
    <a href="/stencil-buffer's-uses-in-unity3d/" class="post-preview">
        <div class="image">
            
                <img src="https://res.cloudinary.com/dokdkay80/image/upload/c_scale,w_380/v1604503676/StencilBuffer/p1_fddhcm.png">
            
        </div>
        <h3 class="title">Stencil Buffer's Uses in Unity3D</h3>
    </a>
</div>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;Understand the Unity GetSpectrumData function, the spectrum datas, the Fourier transform and related theorems and ultilize them to make a audio visualizer in Unity3D.&quot;%20http://localhost:4000/unity3d-audio-visualizer/%20via%20&#64;twitter_username&hashtags=Unity3D,AudioVisualizer,"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/unity3d-audio-visualizer/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="liu_if_else">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/liu_if_else/">liu_if_else</a>
      </h3>
      <p class="desc">Nothing to say.</p>
      <p>
        
          <a href="https://github.com/liu-if-else" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "liu_if_else",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "Blogger",
      "url": "http://localhost:4000/authors/liu_if_else/",
      "sameAs": [
        "https://github.com/liu-if-else"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
    <style>
        .utterances{z-index:-1;}
    </style>
</section>

<script src="https://utteranc.es/client.js"
    repo="liu-if-else/liu-if-else.github.io"
    issue-term="pathname"
    theme="github-light"
    lable="💬comment"
    crossorigin="anonymous"
    async>
</script>

<!--script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'liu-if-else';
        var disqus_title = '';
        var disqus_url = '/unity3d-audio-visualizer/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script-->


        <footer>
    <p>
      
        <a href="https://github.com/liu-if-else" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <!--a href="https://www.facebook.com/facebook_username" title="Facebook"-->
        <a>
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <!--a href="https://twitter.com/twitter_username" title="Twitter"-->
        <a>
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <!--a href="https://medium.com/@medium_username" title="Medium"-->
        <a>
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <!--a href="https://www.instagram.com/instagram_username" title="Instagram"-->
        <a>
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <!--a href="https://www.linkedin.com/in/linkedin_username" title="LinkedIn"-->
        <a>
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="http://localhost:4000/">Home</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/about">About</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/feed.xml">Feed</a>
      </li>
    
  
</ul>

    <!--p>
      <span>Jekflix</span> was made with <svg class="love"><use xlink:href="#icon-heart"></use></svg> by <a href="https://rossener.com" target="_blank" class="creator">Thiago Rossener</a>
    </p-->
    <p>
      Power by <span>Github Pages</span>, <span>Jekyll</span>, and <span>Jetflix</span>
    </p>
</footer>









<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "liu_if_else's blog",
  "description": "A tech blog focusing on game programming and Unity3D.",
  "url": "http://localhost:4000/",
  "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:4000/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/liu-if-else","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/linkedin_username"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script>
            MathJax = {
                tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
                }
            };
        </script>
        <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
        </script>
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "Unity3D Audio Visualizer",
            "headline": "Understand Unity3D's GetSpectrumData function and use it make a audio visulizer.",
            "description": "Understand the Unity GetSpectrumData function, the spectrum datas, the Fourier transform and related theorems and ultilize them to make a audio visualizer in Unity3D.",
            "image": "https://res.cloudinary.com/dokdkay80/image/upload/c_scale,w_760/v1604498366/AudioVisualizer/av1_itqijr.png",
            "url": "http://localhost:4000/unity3d-audio-visualizer/",
            "articleBody": "Menu

  Take a gander at some terminologies and concepts
  Understand the Unity GetSpectrumData function
  The spectrum datas and the Fourier transform
  Provide the spectrum datas to the audio visulizer


Take a gander at some terminologies and concepts

Sound: A sort of wave, viberated in the air with a frequency between 20Hz and 20000Hz.
Sound Frequency: The times that sound viberated per second. It’s unit is herz. 
Sampling: Get a sample, a value, from a sound wave.   
Sampling Rate: The times of the Sampling per second.  
Fast Fourier Transform: the FFT can used to transform signals.
Window Function: To reduce the “signal to noise ratio”.
Decibel: A well-known value used to measure sound’s volume. In this artikel, the strength of the sound wave is a relative value and has nothing to do with the decibel.

Understand the Unity GetSpectrumData function

public void GetSpectrumData(float[] samples, int channel, FFTWindow window);

samples: The array is the return value of the funciton. Each element’s value is the strength of the audio source at a certain frequency. To be optimized for the Fourier transform algorithm, the length of the array must be the power of two, minimal 64 and maximum 8192.
channel: Stereo seperates a audio source into different parts, or say channels, and provided them to distanced audio hardwares to play. In this case, the channel parameter can be used to choose a certain channel to sample by the FFT. Setting to 0 will sample all channels, as same as in case of mono.
window: A helper function for the FFT to reduce noises. There is a trade-off of the complexity of the window-function for reducing the noises.
usage:
public float[] spectrumData=new float[8192];  
thisAudioSource.GetSpectrumData(spectrumData,0,FFTWindow.BlackmanHarris);  


The spectrum datas and the Fourier transform

Given the sampling time T, the samples N and the sampling rate $f_s$, we can make a formula: $T=N/f_s$.

The reciprocal of T, $f_s/N$, is called Frequency Resolution. The charts below are the results of the FFT of the demo audio. They show that the higher the Frequency Resolution the denser the datas transformed.




The length of the spectrumData array is actually the Frequency Resolution and every array’s element has a x/y value in the diagrams above. Unfortunately, we can’t get the frequency, the x, of a element(but well the strength which is y) at runtime and I can’t find any clue in the Unity documentation either. So let’s try to figure it out through some tests.

Using a software to analyze “[MV] FIESTAR(피에스타) _ Mirror.mp3”, we can see that there is a free fall of the strength values at the 16000Hz frequency.



Back to Unity, Debugging the spectrumdata’s values, there is also a significant decrease at spectrumData[5500]. Therefore, it can be deduced that the spectrumData[5500] represences the frequency around 16000Hz. Moreover, 16000Hz/5500*8192=23831Hz, we can also conclude that the highest frequency the function returned is between 22000Hz to 24000Hz.

In addtion to the tests, other clues can be found from the angle of the Fourier Transform. The core algorithm of GetSpectrumData function is the FFT. As mentioned in the beginning, sound is a sort of wave where frequency decided pitch and amplitude determined volume.



The graph above have shown the two sound waves with stable frequency and gradually amplified amplitude in the x-time/y-amplitude plane. According to the superposition principle, simply adding these waves will generate a new complex wave.



This is exactly what happend when the different sound waves met in the air and created a mixed tone. The datas of a audio file are just the discrete samples of a complex sound wave. From this perspective, we can say that making audio/music is adding different sound waves into a complex wave. Just the opposite, the Fourier Transform breaks down complex wave. No matter how complex the wave is, through a series of magical calculations(much more complicated than mixing them), the FT can identify every single-frequency wave within it.

From the viewpoint of two-dimensional space, the Fourier Transform will translate the complex wave from the “x-time/y-amplitude” plane(the last chart above) to the “x-frequency/y-strength”(e.g the third graph) and then to many “x-time/y-strength of a wave with fixed frequency”. The strength of every single wave, the y, on the time axis will become the value of the correspond element of spectrumData array.

In this transfomation process, the FFT firstly needs to sample the original complex wave on the time axis with a fast interval repeatedly. To correctly reconstruct the single-frequency wave, sufficient samples are necessary. Here comes “the Nyquist–Shannon sampling theorem”. To put it simply, the theorem states that the number of the sufficient samples is the frequency multiply by two. For instance, for a 3Hz wave you need 6 samples.

The nowadays music industry adopts the 44100Hz sampling rate standard. So a music audio of one second contains 44100 samples. Because of the restriction of the Nyquist theorem, the highest frequency the FFT can correctly analyze is 22050Hz, which is consistent with the conclusion of the tests above. Given the highest frequency and the length of the spectrumData array, we can further determine the exact frequencies presented by the elements of the array. For example, the demo project has used a 8192 array:

spectrumData[0]		&amp;lt;=&amp;gt;		22050Hz/8192*1    = 2.6916 Hz  &amp;lt;=&amp;gt;  6 times sampling per second
spectrumData[1]		&amp;lt;=&amp;gt;		22050Hz/8192*2    = 5.3833 Hz  &amp;lt;=&amp;gt;  11 times sampling per second
…  
spectrumData[8191]	&amp;lt;=&amp;gt;		22050Hz/8192*8192 = 22050  Hz  &amp;lt;=&amp;gt;  44100 times sampling per second

The dependecies above also tell us that the longer the array the more the sampling and thus the more performance cost of the GetSpectrumData function.

Through adjusting the length of the array, any certain frequency’s strength can be obtained and hence the analyze can be extended to other dimensions, e.g the pitchs.



According to this pitch/frequncy table, the highest pitch’s frequncy of octave 9 is 15804Hz, which explained a little about the free fall at 16000Hz of the FFT result’s chart above as well.

Provide the spectrum datas to the audio visulizer

Github Link of the demo project

In the demo project, I obtained the spectrum datas in Update and injected them to the scale of the cubes and the colors of their materials. The workload is distributed to both CPU and GPU. If you want to reduce the burden of CPU, another idea is to translate the whole spectrum datas, the array, to the GPU(since you have to use this bandwidth to set colors anyway) and to hand over all the work to the shaders, like vertex animation, color calculation and etc. Using vertex or fragment shader to calculate the color instead of CPU is also more friendly for batching and will reduce a lot of SetPass calls.

Since the highest frequncy of the song is below 16000Hz, the audio visualizer only uses the 5461 of 8192 cubes to construct itself.

The core logics of the demo are in the Controller script: 

using UnityEngine;
using System.Collections;
using DG.Tweening;

public class Controller : MonoBehaviour {
    //audio related
    public AudioSource thisAudioSource;
    private float[] spectrumData = new float[8192];
    //cube related
	public GameObject cubePrototype;
	public Transform startPoint;
	private Transform[] cube_transforms=new Transform[8192];
    private Vector3[] cubes_position= new Vector3[8192];
    //color related
    public GridOverlay gridOverlay;
    private MeshRenderer[] cube_meshRenderers = new MeshRenderer[8192];
    private bool cubeColorChange;
    private bool gridColorChange;
    //camera movement related
    public Vector3 cameraStartPoint;
    public Transform cameraTransform;
    public bool lookat0_1;
    public bool lookat1_2;
    public bool lookat2_3;
    public Vector3 lookat0_1_vector = Vector3.zero;
    public Vector3 lookat1_2_vector = new Vector3(106f, 12f, 78f);
    public Vector3 lookat2_3_vector = Vector3.zero;
    private Vector3[] moveTos = new Vector3[8192];
    public Transform cubes_parent;
    private bool cubesRotate = true;
	// Use this for initialization
	void Start () {
        //cube generation
		Vector3 p=startPoint.position;

		for(int i=0;i&amp;lt;8192;i++){
			p=new Vector3(p.x+0.11f,p.y,p.z);
            GameObject cube=Object.Instantiate(cubePrototype,p,cubePrototype.transform.rotation)as GameObject;
			cube_transforms[i]=cube.transform;
            cube_meshRenderers[i] =cube.GetComponent&amp;lt;MeshRenderer&amp;gt;();
		}

		p=startPoint.position;

		float a=2f*Mathf.PI/5461;

		for(int i=0;i&amp;lt;5461;i++){
			cube_transforms[i].position=new Vector3(p.x+Mathf.Cos(a)*131,p.y,p.z+131*Mathf.Sin(a));
			a+=2f*Mathf.PI/5461;
            cubes_position[i]=cube_transforms[i].position;
			cube_transforms[i].parent=startPoint;
		}
        //manage color
        gridColorChange = false;
        cubeColorChange = false;
        Invoke(&quot;SwitchCC&quot;, 3f);
        //manage camera
        cameraStartPoint = cameraTransform.position;
        StartCoroutine(CameraMovement());
        //delay the music
        thisAudioSource.PlayDelayed(2f);
	}
	// Update is called once per frame
	void Update () {
        Spectrum2Cube();
        DynamicColor();
        CameraLookAt();
	}
	//color related
    void SwitchCC(){
        cubeColorChange = !cubeColorChange;
    }
    void SwitchGC(){
        gridColorChange = !gridColorChange;
    }
	void DynamicColor(){
        if (cubeColorChange)
        {
            for (int i = 0; i &amp;lt; 5461; i++)
            {
                cube_meshRenderers[i].material.SetColor(&quot;_Color&quot;, new Vector4(Mathf.Lerp(cube_meshRenderers[i].material.color.r, spectrumData[i] * 500f, 0.2f), 0.5f, 1f, 1f));
            }
        }
        if (gridColorChange)
        {
            float gridColor = Mathf.Lerp(gridOverlay.mainColor.r, spectrumData[2000] * 1000, 0.5f);
            if (gridColor &amp;gt; 1)
            {
                gridColor = 1;
            }
            gridOverlay.mainColor = new Vector4(gridColor, 0.5f, 1f, 1f);
        }
    }
    //inject spectrumDatas to the scale of the cubes
    void Spectrum2Cube(){
        thisAudioSource.GetSpectrumData(spectrumData, 0, FFTWindow.BlackmanHarris);
        for (int i = 0; i &amp;lt; 5461; i++)
        {
            cube_transforms[i].localScale = new Vector3(0.15f, Mathf.Lerp(cube_transforms[i].localScale.y, spectrumData[i] * 10000f, 0.5f), 0.15f);
        }
    }
    //manage the angles of the camera
    void CameraLookAt(){
        if (lookat0_1)
        {
            cameraTransform.LookAt(lookat0_1_vector);
        }
        if (lookat1_2)
        {
            cameraTransform.LookAt(lookat1_2_vector);

        }
        if (lookat2_3)
        {
            cameraTransform.LookAt(cubes_position[5190]);
        }
    }
    //animate the grid
    IEnumerator GridOff()
    {
        for (int i = 0; i &amp;lt; 51; i++)
        {
            gridOverlay.largeStep += 10;
            yield return new WaitForSeconds(0.02f);
        }
        gridOverlay.showMain = false;

    }
    IEnumerator GridOn()
    {
        gridOverlay.showMain = true;
        gridColorChange = true;
        gridOverlay.largeStep = 500;
        for (int i = 0; i &amp;lt; 49; i++)
        {
            gridOverlay.largeStep -= 10;
            yield return new WaitForSeconds(0.02f);
        }
    }
    //repeat the camera movement. TODO: exit mechanism
    public void CameraRepeatMove()
    {
        StopAllCoroutines();
        StartCoroutine(CameraMovement());
        if (cubesRotate)
        {
            cubesRotate = false;
            cubes_parent.DORotate(new Vector3(0f, 360f, 0f), 117f, RotateMode.FastBeyond360);
        }
        gridColorChange = false;
    }
    //move the camera
    IEnumerator CameraMovement()
    {
        yield return new WaitForSeconds(20f);
        lookat2_3_vector = new Vector3(cubes_position[5200].x, 12f, cubes_position[5200].z);
        cameraTransform.DOMove(startPoint.position, 20f);
        for (int i = 0; i &amp;lt; 8192; i++)
        {
            moveTos[i] = new Vector3(cubes_position[i].x, 10f, cubes_position[i].z);
        }
        yield return new WaitForSeconds(20f);
        cameraTransform.DOMove(new Vector3(126f, 252f, 1f), 10f);
        cameraTransform.DOLookAt(Vector3.zero, 10f, AxisConstraint.None, Vector3.up);
        yield return new WaitForSeconds(10f);
        cameraTransform.DOMove(new Vector3(106f, 12f, 78f), 19f);
        cameraTransform.DOLookAt(lookat1_2_vector, 19f, AxisConstraint.None, Vector3.up);
        yield return new WaitForSeconds(19f);
        lookat1_2 = false;
        StartCoroutine(GridOn());
        cameraTransform.DOLookAt(lookat2_3_vector, 8f, AxisConstraint.None, Vector3.up);
        cameraTransform.DOMove(new Vector3(cubes_position[5460].x, 12f, cubes_position[5460].z), 8f);
        yield return new WaitForSeconds(8f);
        cameraTransform.DOLookAt(cubes_position[5200], 2f, AxisConstraint.None, Vector3.up);
        yield return new WaitForSeconds(2f);
        int counter = 0;
        while (counter &amp;lt; 2700)
        {
            cameraTransform.LookAt(cubes_position[5200 - counter]);
            cameraTransform.DOMove(moveTos[5460 - counter], 0.01f);
            yield return new WaitForSeconds(0.01f);
            counter += 10;
        }
        cameraTransform.DOLookAt(lookat0_1_vector, 3f, AxisConstraint.None, Vector3.up);
        yield return new WaitForSeconds(3f);
        StartCoroutine(GridOff());
        lookat0_1 = true;
        cameraTransform.DOMove(new Vector3(cameraStartPoint.x, cameraStartPoint.y + 300f, cameraStartPoint.z), 6f);
        yield return new WaitForSeconds(6f);
        lookat0_1 = false;
        CameraRepeatMove();
    }
} 


Screenshots from the Editor:






References:
the Nyquist–Shannon sampling theorem — Zero to One
https://www.cnblogs.com/zoneofmine/p/10853096.html

Algorithmic Beat Mapping in Unity: Real-time Audio Analysis Using the Unity API — Jesse
https://medium.com/giant-scam/algorithmic-beat-mapping-in-unity-real-time-audio-analysis-using-the-unity-api-6e9595823ce4

What is the Fourier Transform — 3Blue1Brown
https://www.youtube.com/watch?v=spUNpyF58BY


Chinese Version of this artikel:
https://blog.csdn.net/liu_if_else/article/details/51233799
",
            "wordcount": "2951",
            "inLanguage": "en",
            "dateCreated": "2020-11-04/",
            "datePublished": "2020-11-04/",
            "dateModified": "2020-11-04/",
            "author": {
                "@type": "Person",
                "name": "liu_if_else",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "Blogger",
                "url": "http://localhost:4000/authors/liu_if_else/",
                "sameAs": [
                    "https://github.com/liu-if-else"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "liu_if_else's blog",
                "url": "http://localhost:4000/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "http://localhost:4000/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "Unity3D",
            "articleSection": "Unity3D",
            "keywords": ["Unity3D","AudioVisualizer"]
        }
        </script>
    </body>
</html>
